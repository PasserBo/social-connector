{"ast":null,"code":"import _objectSpread from\"/Users/jvledesma/Downloads/vuexy-admin-v8.0.0/react-version/Bootstrap5/full-version/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/jvledesma/Downloads/vuexy-admin-v8.0.0/react-version/Bootstrap5/full-version/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";// ** React Imports\nimport ReactDOM from'react-dom';import{useState,useEffect,useRef}from'react';// ** Custom Components\nimport Avatar from'@components/avatar';// ** Store & Actions\nimport{sendMsg}from'./store';import{useDispatch}from'react-redux';// ** Third Party Components\nimport classnames from'classnames';import PerfectScrollbar from'react-perfect-scrollbar';import{MessageSquare,Menu,PhoneCall,Video,Search,MoreVertical,Mic,Image,Send}from'react-feather';// ** Reactstrap Imports\nimport{Form,Label,Input,Button,InputGroup,DropdownItem,DropdownMenu,DropdownToggle,InputGroupText,UncontrolledDropdown}from'reactstrap';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChatLog=function ChatLog(props){// ** Props & Store\nvar handleUser=props.handleUser,handleUserSidebarRight=props.handleUserSidebarRight,handleSidebar=props.handleSidebar,store=props.store,userSidebarLeft=props.userSidebarLeft;var userProfile=store.userProfile,selectedUser=store.selectedUser;// ** Refs & Dispatch\nvar chatArea=useRef(null);var dispatch=useDispatch();// ** State\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),msg=_useState2[0],setMsg=_useState2[1];// ** Scroll to chat bottom\nvar scrollToBottom=function scrollToBottom(){var chatContainer=ReactDOM.findDOMNode(chatArea.current);chatContainer.scrollTop=Number.MAX_SAFE_INTEGER;};// ** If user chat is not empty scrollToBottom\nuseEffect(function(){var selectedUserLen=Object.keys(selectedUser).length;if(selectedUserLen){scrollToBottom();}},[selectedUser]);// ** Formats chat data based on sender\nvar formattedChatData=function formattedChatData(){var chatLog=[];if(selectedUser.chat){chatLog=selectedUser.chat.chat;}var formattedChatLog=[];var chatMessageSenderId=chatLog[0]?chatLog[0].senderId:undefined;var msgGroup={senderId:chatMessageSenderId,messages:[]};chatLog.forEach(function(msg,index){if(chatMessageSenderId===msg.senderId){msgGroup.messages.push({msg:msg.message,time:msg.time});}else{chatMessageSenderId=msg.senderId;formattedChatLog.push(msgGroup);msgGroup={senderId:msg.senderId,messages:[{msg:msg.message,time:msg.time}]};}if(index===chatLog.length-1)formattedChatLog.push(msgGroup);});return formattedChatLog;};// ** Renders user chat\nvar renderChats=function renderChats(){return formattedChatData().map(function(item,index){return/*#__PURE__*/_jsxs(\"div\",{className:classnames('chat',{'chat-left':item.senderId!==11}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-avatar\",children:/*#__PURE__*/_jsx(Avatar,{imgWidth:36,imgHeight:36,className:\"box-shadow-1 cursor-pointer\",img:item.senderId===11?userProfile.avatar:selectedUser.contact.avatar})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-body\",children:item.messages.map(function(chat){return/*#__PURE__*/_jsx(\"div\",{className:\"chat-content\",children:/*#__PURE__*/_jsx(\"p\",{children:chat.msg})},chat.msg);})})]},index);});};// ** Opens right sidebar & handles its data\nvar handleAvatarClick=function handleAvatarClick(obj){handleUserSidebarRight();handleUser(obj);};// ** On mobile screen open left sidebar on Start Conversation Click\nvar handleStartConversation=function handleStartConversation(){if(!Object.keys(selectedUser).length&&!userSidebarLeft&&window.innerWidth<992){handleSidebar();}};// ** Sends New Msg\nvar handleSendMsg=function handleSendMsg(e){e.preventDefault();if(msg.length){dispatch(sendMsg(_objectSpread(_objectSpread({},selectedUser),{},{message:msg})));setMsg('');}};// ** ChatWrapper tag based on chat's length\nvar ChatWrapper=Object.keys(selectedUser).length&&selectedUser.chat?PerfectScrollbar:'div';return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-app-window\",children:[/*#__PURE__*/_jsxs(\"div\",{className:classnames('start-chat-area',{'d-none':Object.keys(selectedUser).length}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"start-chat-icon mb-1\",children:/*#__PURE__*/_jsx(MessageSquare,{})}),/*#__PURE__*/_jsx(\"h4\",{className:\"sidebar-toggle start-chat-text\",onClick:handleStartConversation,children:\"Start Conversation\"})]}),Object.keys(selectedUser).length?/*#__PURE__*/_jsxs(\"div\",{className:classnames('active-chat',{'d-none':selectedUser===null}),children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-navbar\",children:/*#__PURE__*/_jsxs(\"header\",{className:\"chat-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebar-toggle d-block d-lg-none me-1\",onClick:handleSidebar,children:/*#__PURE__*/_jsx(Menu,{size:21})}),/*#__PURE__*/_jsx(Avatar,{imgHeight:\"36\",imgWidth:\"36\",img:selectedUser.contact.avatar,status:selectedUser.contact.status,className:\"avatar-border user-profile-toggle m-0 me-1\",onClick:function onClick(){return handleAvatarClick(selectedUser.contact);}}),/*#__PURE__*/_jsx(\"h6\",{className:\"mb-0\",children:selectedUser.contact.fullName})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center\",children:[/*#__PURE__*/_jsx(PhoneCall,{size:18,className:\"cursor-pointer d-sm-block d-none me-1\"}),/*#__PURE__*/_jsx(Video,{size:18,className:\"cursor-pointer d-sm-block d-none me-1\"}),/*#__PURE__*/_jsx(Search,{size:18,className:\"cursor-pointer d-sm-block d-none\"}),/*#__PURE__*/_jsxs(UncontrolledDropdown,{className:\"more-options-dropdown\",children:[/*#__PURE__*/_jsx(DropdownToggle,{className:\"btn-icon\",color:\"transparent\",size:\"sm\",children:/*#__PURE__*/_jsx(MoreVertical,{size:\"18\"})}),/*#__PURE__*/_jsxs(DropdownMenu,{end:true,children:[/*#__PURE__*/_jsx(DropdownItem,{href:\"/\",onClick:function onClick(e){return e.preventDefault();},children:\"View Contact\"}),/*#__PURE__*/_jsx(DropdownItem,{href:\"/\",onClick:function onClick(e){return e.preventDefault();},children:\"Mute Notifications\"}),/*#__PURE__*/_jsx(DropdownItem,{href:\"/\",onClick:function onClick(e){return e.preventDefault();},children:\"Block Contact\"}),/*#__PURE__*/_jsx(DropdownItem,{href:\"/\",onClick:function onClick(e){return e.preventDefault();},children:\"Clear Chat\"}),/*#__PURE__*/_jsx(DropdownItem,{href:\"/\",onClick:function onClick(e){return e.preventDefault();},children:\"Report\"})]})]})]})]})}),/*#__PURE__*/_jsx(ChatWrapper,{ref:chatArea,className:\"user-chats\",options:{wheelPropagation:false},children:selectedUser.chat?/*#__PURE__*/_jsx(\"div\",{className:\"chats\",children:renderChats()}):null}),/*#__PURE__*/_jsxs(Form,{className:\"chat-app-form\",onSubmit:function onSubmit(e){return handleSendMsg(e);},children:[/*#__PURE__*/_jsxs(InputGroup,{className:\"input-group-merge me-1 form-send-message\",children:[/*#__PURE__*/_jsx(InputGroupText,{children:/*#__PURE__*/_jsx(Mic,{className:\"cursor-pointer\",size:14})}),/*#__PURE__*/_jsx(Input,{value:msg,onChange:function onChange(e){return setMsg(e.target.value);},placeholder:\"Type your message or use speech to text\"}),/*#__PURE__*/_jsx(InputGroupText,{children:/*#__PURE__*/_jsxs(Label,{className:\"attachment-icon mb-0\",for:\"attach-doc\",children:[/*#__PURE__*/_jsx(Image,{className:\"cursor-pointer text-secondary\",size:14}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"attach-doc\",hidden:true})]})})]}),/*#__PURE__*/_jsxs(Button,{className:\"send\",color:\"primary\",children:[/*#__PURE__*/_jsx(Send,{size:14,className:\"d-lg-none\"}),/*#__PURE__*/_jsx(\"span\",{className:\"d-none d-lg-block\",children:\"Send\"})]})]})]}):null]});};export default ChatLog;","map":{"version":3,"sources":["/Users/jvledesma/Downloads/vuexy-admin-v8.0.0/react-version/Bootstrap5/full-version/src/views/apps/chat/Chat.js"],"names":["ReactDOM","useState","useEffect","useRef","Avatar","sendMsg","useDispatch","classnames","PerfectScrollbar","MessageSquare","Menu","PhoneCall","Video","Search","MoreVertical","Mic","Image","Send","Form","Label","Input","Button","InputGroup","DropdownItem","DropdownMenu","DropdownToggle","InputGroupText","UncontrolledDropdown","ChatLog","props","handleUser","handleUserSidebarRight","handleSidebar","store","userSidebarLeft","userProfile","selectedUser","chatArea","dispatch","msg","setMsg","scrollToBottom","chatContainer","findDOMNode","current","scrollTop","Number","MAX_SAFE_INTEGER","selectedUserLen","Object","keys","length","formattedChatData","chatLog","chat","formattedChatLog","chatMessageSenderId","senderId","undefined","msgGroup","messages","forEach","index","push","message","time","renderChats","map","item","avatar","contact","handleAvatarClick","obj","handleStartConversation","window","innerWidth","handleSendMsg","e","preventDefault","ChatWrapper","status","fullName","wheelPropagation","target","value"],"mappings":"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","sourcesContent":["// ** React Imports\r\nimport ReactDOM from 'react-dom'\r\nimport { useState, useEffect, useRef } from 'react'\r\n\r\n// ** Custom Components\r\nimport Avatar from '@components/avatar'\r\n\r\n// ** Store & Actions\r\nimport { sendMsg } from './store'\r\nimport { useDispatch } from 'react-redux'\r\n\r\n// ** Third Party Components\r\nimport classnames from 'classnames'\r\nimport PerfectScrollbar from 'react-perfect-scrollbar'\r\nimport { MessageSquare, Menu, PhoneCall, Video, Search, MoreVertical, Mic, Image, Send } from 'react-feather'\r\n\r\n// ** Reactstrap Imports\r\nimport {\r\n  Form,\r\n  Label,\r\n  Input,\r\n  Button,\r\n  InputGroup,\r\n  DropdownItem,\r\n  DropdownMenu,\r\n  DropdownToggle,\r\n  InputGroupText,\r\n  UncontrolledDropdown\r\n} from 'reactstrap'\r\n\r\nconst ChatLog = props => {\r\n  // ** Props & Store\r\n  const { handleUser, handleUserSidebarRight, handleSidebar, store, userSidebarLeft } = props\r\n  const { userProfile, selectedUser } = store\r\n\r\n  // ** Refs & Dispatch\r\n  const chatArea = useRef(null)\r\n  const dispatch = useDispatch()\r\n\r\n  // ** State\r\n  const [msg, setMsg] = useState('')\r\n\r\n  // ** Scroll to chat bottom\r\n  const scrollToBottom = () => {\r\n    const chatContainer = ReactDOM.findDOMNode(chatArea.current)\r\n    chatContainer.scrollTop = Number.MAX_SAFE_INTEGER\r\n  }\r\n\r\n  // ** If user chat is not empty scrollToBottom\r\n  useEffect(() => {\r\n    const selectedUserLen = Object.keys(selectedUser).length\r\n\r\n    if (selectedUserLen) {\r\n      scrollToBottom()\r\n    }\r\n  }, [selectedUser])\r\n\r\n  // ** Formats chat data based on sender\r\n  const formattedChatData = () => {\r\n    let chatLog = []\r\n    if (selectedUser.chat) {\r\n      chatLog = selectedUser.chat.chat\r\n    }\r\n\r\n    const formattedChatLog = []\r\n    let chatMessageSenderId = chatLog[0] ? chatLog[0].senderId : undefined\r\n    let msgGroup = {\r\n      senderId: chatMessageSenderId,\r\n      messages: []\r\n    }\r\n    chatLog.forEach((msg, index) => {\r\n      if (chatMessageSenderId === msg.senderId) {\r\n        msgGroup.messages.push({\r\n          msg: msg.message,\r\n          time: msg.time\r\n        })\r\n      } else {\r\n        chatMessageSenderId = msg.senderId\r\n        formattedChatLog.push(msgGroup)\r\n        msgGroup = {\r\n          senderId: msg.senderId,\r\n          messages: [\r\n            {\r\n              msg: msg.message,\r\n              time: msg.time\r\n            }\r\n          ]\r\n        }\r\n      }\r\n      if (index === chatLog.length - 1) formattedChatLog.push(msgGroup)\r\n    })\r\n    return formattedChatLog\r\n  }\r\n\r\n  // ** Renders user chat\r\n  const renderChats = () => {\r\n    return formattedChatData().map((item, index) => {\r\n      return (\r\n        <div\r\n          key={index}\r\n          className={classnames('chat', {\r\n            'chat-left': item.senderId !== 11\r\n          })}\r\n        >\r\n          <div className='chat-avatar'>\r\n            <Avatar\r\n              imgWidth={36}\r\n              imgHeight={36}\r\n              className='box-shadow-1 cursor-pointer'\r\n              img={item.senderId === 11 ? userProfile.avatar : selectedUser.contact.avatar}\r\n            />\r\n          </div>\r\n\r\n          <div className='chat-body'>\r\n            {item.messages.map(chat => (\r\n              <div key={chat.msg} className='chat-content'>\r\n                <p>{chat.msg}</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )\r\n    })\r\n  }\r\n\r\n  // ** Opens right sidebar & handles its data\r\n  const handleAvatarClick = obj => {\r\n    handleUserSidebarRight()\r\n    handleUser(obj)\r\n  }\r\n\r\n  // ** On mobile screen open left sidebar on Start Conversation Click\r\n  const handleStartConversation = () => {\r\n    if (!Object.keys(selectedUser).length && !userSidebarLeft && window.innerWidth < 992) {\r\n      handleSidebar()\r\n    }\r\n  }\r\n\r\n  // ** Sends New Msg\r\n  const handleSendMsg = e => {\r\n    e.preventDefault()\r\n    if (msg.length) {\r\n      dispatch(sendMsg({ ...selectedUser, message: msg }))\r\n      setMsg('')\r\n    }\r\n  }\r\n\r\n  // ** ChatWrapper tag based on chat's length\r\n  const ChatWrapper = Object.keys(selectedUser).length && selectedUser.chat ? PerfectScrollbar : 'div'\r\n\r\n  return (\r\n    <div className='chat-app-window'>\r\n      <div className={classnames('start-chat-area', { 'd-none': Object.keys(selectedUser).length })}>\r\n        <div className='start-chat-icon mb-1'>\r\n          <MessageSquare />\r\n        </div>\r\n        <h4 className='sidebar-toggle start-chat-text' onClick={handleStartConversation}>\r\n          Start Conversation\r\n        </h4>\r\n      </div>\r\n      {Object.keys(selectedUser).length ? (\r\n        <div className={classnames('active-chat', { 'd-none': selectedUser === null })}>\r\n          <div className='chat-navbar'>\r\n            <header className='chat-header'>\r\n              <div className='d-flex align-items-center'>\r\n                <div className='sidebar-toggle d-block d-lg-none me-1' onClick={handleSidebar}>\r\n                  <Menu size={21} />\r\n                </div>\r\n                <Avatar\r\n                  imgHeight='36'\r\n                  imgWidth='36'\r\n                  img={selectedUser.contact.avatar}\r\n                  status={selectedUser.contact.status}\r\n                  className='avatar-border user-profile-toggle m-0 me-1'\r\n                  onClick={() => handleAvatarClick(selectedUser.contact)}\r\n                />\r\n                <h6 className='mb-0'>{selectedUser.contact.fullName}</h6>\r\n              </div>\r\n              <div className='d-flex align-items-center'>\r\n                <PhoneCall size={18} className='cursor-pointer d-sm-block d-none me-1' />\r\n                <Video size={18} className='cursor-pointer d-sm-block d-none me-1' />\r\n                <Search size={18} className='cursor-pointer d-sm-block d-none' />\r\n                <UncontrolledDropdown className='more-options-dropdown'>\r\n                  <DropdownToggle className='btn-icon' color='transparent' size='sm'>\r\n                    <MoreVertical size='18' />\r\n                  </DropdownToggle>\r\n                  <DropdownMenu end>\r\n                    <DropdownItem href='/' onClick={e => e.preventDefault()}>\r\n                      View Contact\r\n                    </DropdownItem>\r\n                    <DropdownItem href='/' onClick={e => e.preventDefault()}>\r\n                      Mute Notifications\r\n                    </DropdownItem>\r\n                    <DropdownItem href='/' onClick={e => e.preventDefault()}>\r\n                      Block Contact\r\n                    </DropdownItem>\r\n                    <DropdownItem href='/' onClick={e => e.preventDefault()}>\r\n                      Clear Chat\r\n                    </DropdownItem>\r\n                    <DropdownItem href='/' onClick={e => e.preventDefault()}>\r\n                      Report\r\n                    </DropdownItem>\r\n                  </DropdownMenu>\r\n                </UncontrolledDropdown>\r\n              </div>\r\n            </header>\r\n          </div>\r\n\r\n          <ChatWrapper ref={chatArea} className='user-chats' options={{ wheelPropagation: false }}>\r\n            {selectedUser.chat ? <div className='chats'>{renderChats()}</div> : null}\r\n          </ChatWrapper>\r\n\r\n          <Form className='chat-app-form' onSubmit={e => handleSendMsg(e)}>\r\n            <InputGroup className='input-group-merge me-1 form-send-message'>\r\n              <InputGroupText>\r\n                <Mic className='cursor-pointer' size={14} />\r\n              </InputGroupText>\r\n              <Input\r\n                value={msg}\r\n                onChange={e => setMsg(e.target.value)}\r\n                placeholder='Type your message or use speech to text'\r\n              />\r\n              <InputGroupText>\r\n                <Label className='attachment-icon mb-0' for='attach-doc'>\r\n                  <Image className='cursor-pointer text-secondary' size={14} />\r\n                  <input type='file' id='attach-doc' hidden />\r\n                </Label>\r\n              </InputGroupText>\r\n            </InputGroup>\r\n            <Button className='send' color='primary'>\r\n              <Send size={14} className='d-lg-none' />\r\n              <span className='d-none d-lg-block'>Send</span>\r\n            </Button>\r\n          </Form>\r\n        </div>\r\n      ) : null}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ChatLog\r\n"]},"metadata":{},"sourceType":"module"}