{"ast":null,"code":"import mock from '../mock';\nimport jwt from 'jsonwebtoken';\nconst data = {\n  users: [{\n    id: 1,\n    fullName: 'John Doe',\n    username: 'johndoe',\n    password: 'admin',\n    avatar: require('@src/assets/images/portrait/small/avatar-s-11.jpg').default,\n    email: 'admin@demo.com',\n    role: 'admin',\n    extras: {\n      eCommerceCartItemsCount: 5\n    }\n  }, {\n    id: 2,\n    fullName: 'Jane Doe',\n    username: 'janedoe',\n    password: 'client',\n    avatar: require('@src/assets/images/avatars/1-small.png').default,\n    email: 'client@demo.com',\n    role: 'client',\n    extras: {\n      eCommerceCartItemsCount: 5\n    }\n  }]\n}; // ! These two secrets shall be in .env file and not in any other file\n\nconst jwtConfig = {\n  secret: 'dd5f3089-40c3-403d-af14-d0c228b05cb4',\n  refreshTokenSecret: '7c4c1c50-3230-45bf-9eae-c9b2e401c767',\n  expireTime: '10m',\n  refreshTokenExpireTime: '10m'\n};\nmock.onPost('/jwt/login').reply(request => {\n  const {\n    email,\n    password\n  } = JSON.parse(request.data);\n  let error = {\n    email: ['Something went wrong']\n  };\n  const user = data.users.find(u => u.email === email && u.password === password);\n\n  if (user) {\n    try {\n      const accessToken = jwt.sign({\n        id: user.id\n      }, jwtConfig.secret, {\n        expiresIn: jwtConfig.expireTime\n      });\n      const refreshToken = jwt.sign({\n        id: user.id\n      }, jwtConfig.refreshTokenSecret, {\n        expiresIn: jwtConfig.refreshTokenExpireTime\n      });\n      const userData = { ...user\n      };\n      delete userData.password;\n      const response = {\n        userData,\n        accessToken,\n        refreshToken\n      };\n      return [200, response];\n    } catch (e) {\n      error = e;\n    }\n  } else {\n    error = {\n      email: ['Email or Password is Invalid']\n    };\n  }\n\n  return [400, {\n    error\n  }];\n});\nmock.onPost('/jwt/register').reply(request => {\n  if (request.data.length > 0) {\n    const {\n      email,\n      password,\n      username\n    } = JSON.parse(request.data);\n    const isEmailAlreadyInUse = data.users.find(user => user.email === email);\n    const isUsernameAlreadyInUse = data.users.find(user => user.username === username);\n    const error = {\n      email: isEmailAlreadyInUse ? 'This email is already in use.' : null,\n      username: isUsernameAlreadyInUse ? 'This username is already in use.' : null\n    };\n\n    if (!error.username && !error.email) {\n      const userData = {\n        email,\n        password,\n        username,\n        fullName: '',\n        avatar: null,\n        role: 'admin'\n      }; // Add user id\n\n      const length = data.users.length;\n      let lastIndex = 0;\n\n      if (length) {\n        lastIndex = data.users[length - 1].id;\n      }\n\n      userData.id = lastIndex + 1;\n      data.users.push(userData);\n      const accessToken = jwt.sign({\n        id: userData.id\n      }, jwtConfig.secret, {\n        expiresIn: jwtConfig.expireTime\n      });\n      const user = Object.assign({}, userData);\n      delete user['password'];\n      const response = {\n        user,\n        accessToken\n      };\n      return [200, response];\n    } else {\n      return [200, {\n        error\n      }];\n    }\n  }\n});\nmock.onPost('/jwt/refresh-token').reply(request => {\n  const {\n    refreshToken\n  } = JSON.parse(request.data);\n\n  try {\n    const {\n      id\n    } = jwt.verify(refreshToken, jwtConfig.refreshTokenSecret);\n    const userData = { ...data.users.find(user => user.id === id)\n    };\n    const newAccessToken = jwt.sign({\n      id: userData.id\n    }, jwtConfig.secret, {\n      expiresIn: jwtConfig.expiresIn\n    });\n    const newRefreshToken = jwt.sign({\n      id: userData.id\n    }, jwtConfig.refreshTokenSecret, {\n      expiresIn: jwtConfig.refreshTokenExpireTime\n    });\n    delete userData.password;\n    const response = {\n      userData,\n      accessToken: newAccessToken,\n      refreshToken: newRefreshToken\n    };\n    return [200, response];\n  } catch (e) {\n    const error = 'Invalid refresh token';\n    return [401, {\n      error\n    }];\n  }\n});","map":{"version":3,"sources":["/Users/jvledesma/Downloads/react-version/full-version/src/@local-db/jwt/index.js"],"names":["mock","jwt","data","users","id","fullName","username","password","avatar","require","default","email","role","extras","eCommerceCartItemsCount","jwtConfig","secret","refreshTokenSecret","expireTime","refreshTokenExpireTime","onPost","reply","request","JSON","parse","error","user","find","u","accessToken","sign","expiresIn","refreshToken","userData","response","e","length","isEmailAlreadyInUse","isUsernameAlreadyInUse","lastIndex","push","Object","assign","verify","newAccessToken","newRefreshToken"],"mappings":"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","sourcesContent":["import mock from '../mock'\r\nimport jwt from 'jsonwebtoken'\r\n\r\nconst data = {\r\n  users: [\r\n    {\r\n      id: 1,\r\n      fullName: 'John Doe',\r\n      username: 'johndoe',\r\n      password: 'admin',\r\n      avatar: require('@src/assets/images/portrait/small/avatar-s-11.jpg').default,\r\n      email: 'admin@demo.com',\r\n      role: 'admin',\r\n      extras: {\r\n        eCommerceCartItemsCount: 5\r\n      }\r\n    },\r\n    {\r\n      id: 2,\r\n      fullName: 'Jane Doe',\r\n      username: 'janedoe',\r\n      password: 'client',\r\n      avatar: require('@src/assets/images/avatars/1-small.png').default,\r\n      email: 'client@demo.com',\r\n      role: 'client',\r\n      extras: {\r\n        eCommerceCartItemsCount: 5\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\n// ! These two secrets shall be in .env file and not in any other file\r\nconst jwtConfig = {\r\n  secret: 'dd5f3089-40c3-403d-af14-d0c228b05cb4',\r\n  refreshTokenSecret: '7c4c1c50-3230-45bf-9eae-c9b2e401c767',\r\n  expireTime: '10m',\r\n  refreshTokenExpireTime: '10m'\r\n}\r\n\r\nmock.onPost('/jwt/login').reply(request => {\r\n  const { email, password } = JSON.parse(request.data)\r\n\r\n  let error = {\r\n    email: ['Something went wrong']\r\n  }\r\n\r\n  const user = data.users.find(u => u.email === email && u.password === password)\r\n\r\n  if (user) {\r\n    try {\r\n      const accessToken = jwt.sign({ id: user.id }, jwtConfig.secret, { expiresIn: jwtConfig.expireTime })\r\n      const refreshToken = jwt.sign({ id: user.id }, jwtConfig.refreshTokenSecret, {\r\n        expiresIn: jwtConfig.refreshTokenExpireTime\r\n      })\r\n\r\n      const userData = { ...user }\r\n\r\n      delete userData.password\r\n\r\n      const response = {\r\n        userData,\r\n        accessToken,\r\n        refreshToken\r\n      }\r\n\r\n      return [200, response]\r\n    } catch (e) {\r\n      error = e\r\n    }\r\n  } else {\r\n    error = {\r\n      email: ['Email or Password is Invalid']\r\n    }\r\n  }\r\n\r\n  return [400, { error }]\r\n})\r\n\r\nmock.onPost('/jwt/register').reply(request => {\r\n  if (request.data.length > 0) {\r\n    const { email, password, username } = JSON.parse(request.data)\r\n    const isEmailAlreadyInUse = data.users.find(user => user.email === email)\r\n    const isUsernameAlreadyInUse = data.users.find(user => user.username === username)\r\n    const error = {\r\n      email: isEmailAlreadyInUse ? 'This email is already in use.' : null,\r\n      username: isUsernameAlreadyInUse ? 'This username is already in use.' : null\r\n    }\r\n\r\n    if (!error.username && !error.email) {\r\n      const userData = {\r\n        email,\r\n        password,\r\n        username,\r\n        fullName: '',\r\n        avatar: null,\r\n        role: 'admin'\r\n      }\r\n\r\n      // Add user id\r\n      const length = data.users.length\r\n      let lastIndex = 0\r\n      if (length) {\r\n        lastIndex = data.users[length - 1].id\r\n      }\r\n      userData.id = lastIndex + 1\r\n\r\n      data.users.push(userData)\r\n\r\n      const accessToken = jwt.sign({ id: userData.id }, jwtConfig.secret, { expiresIn: jwtConfig.expireTime })\r\n\r\n      const user = Object.assign({}, userData)\r\n      delete user['password']\r\n      const response = { user, accessToken }\r\n\r\n      return [200, response]\r\n    } else {\r\n      return [200, { error }]\r\n    }\r\n  }\r\n})\r\n\r\nmock.onPost('/jwt/refresh-token').reply(request => {\r\n  const { refreshToken } = JSON.parse(request.data)\r\n\r\n  try {\r\n    const { id } = jwt.verify(refreshToken, jwtConfig.refreshTokenSecret)\r\n\r\n    const userData = { ...data.users.find(user => user.id === id) }\r\n\r\n    const newAccessToken = jwt.sign({ id: userData.id }, jwtConfig.secret, { expiresIn: jwtConfig.expiresIn })\r\n    const newRefreshToken = jwt.sign({ id: userData.id }, jwtConfig.refreshTokenSecret, {\r\n      expiresIn: jwtConfig.refreshTokenExpireTime\r\n    })\r\n\r\n    delete userData.password\r\n    const response = {\r\n      userData,\r\n      accessToken: newAccessToken,\r\n      refreshToken: newRefreshToken\r\n    }\r\n\r\n    return [200, response]\r\n  } catch (e) {\r\n    const error = 'Invalid refresh token'\r\n    return [401, { error }]\r\n  }\r\n})\r\n"]},"metadata":{},"sourceType":"module"}