{"ast":null,"code":"import _asyncToGenerator from \"/Users/jvledesma/Downloads/vuexy-admin-v8.0.0/react-version/Bootstrap5/full-version/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _regeneratorRuntime from \"/Users/jvledesma/Downloads/vuexy-admin-v8.0.0/react-version/Bootstrap5/full-version/node_modules/@babel/runtime/regenerator/index.js\";\nimport * as queryString from 'query-string';\nimport { decodeToken } from 'jsontokens';\nimport { BLOCKSTACK_HANDLER, getGlobalObject, fetchPrivate } from '@stacks/common';\nexport function getAuthRequestFromURL() {\n  var location = getGlobalObject('location', {\n    throwIfUnavailable: true,\n    usageDesc: 'getAuthRequestFromURL'\n  });\n\n  if (location === null || location === void 0 ? void 0 : location.search) {\n    var queryDict = queryString.parse(location === null || location === void 0 ? void 0 : location.search);\n\n    if (queryDict.authRequest) {\n      return queryDict.authRequest.split(\"\".concat(BLOCKSTACK_HANDLER, \":\")).join('');\n    } else {\n      return null;\n    }\n  } else {\n    return null;\n  }\n}\nexport function fetchAppManifest(_x) {\n  return _fetchAppManifest.apply(this, arguments);\n}\n\nfunction _fetchAppManifest() {\n  _fetchAppManifest = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(authRequest) {\n    var payload, manifestURI, response, responseText, responseJSON;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (authRequest) {\n              _context.next = 2;\n              break;\n            }\n\n            throw new Error('Invalid auth request');\n\n          case 2:\n            payload = decodeToken(authRequest).payload;\n\n            if (!(typeof payload === 'string')) {\n              _context.next = 5;\n              break;\n            }\n\n            throw new Error('Unexpected token payload type of string');\n\n          case 5:\n            manifestURI = payload.manifest_uri;\n            _context.prev = 6;\n            _context.next = 9;\n            return fetchPrivate(manifestURI);\n\n          case 9:\n            response = _context.sent;\n            _context.next = 12;\n            return response.text();\n\n          case 12:\n            responseText = _context.sent;\n            responseJSON = JSON.parse(responseText);\n            return _context.abrupt(\"return\", Object.assign(Object.assign({}, responseJSON), {\n              manifestURI: manifestURI\n            }));\n\n          case 17:\n            _context.prev = 17;\n            _context.t0 = _context[\"catch\"](6);\n            console.log(_context.t0);\n            throw new Error('Could not fetch manifest.json');\n\n          case 21:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[6, 17]]);\n  }));\n  return _fetchAppManifest.apply(this, arguments);\n}","map":{"version":3,"sources":["../../src/provider.ts"],"names":[],"mappings":";;AAAA,OAAO,KAAK,WAAZ,MAA6B,cAA7B;AACA,SAAS,WAAT,QAA4B,YAA5B;AACA,SAAS,kBAAT,EAA6B,eAA7B,EAA8C,YAA9C,QAAkE,gBAAlE;AASA,OAAM,SAAU,qBAAV,GAA+B;AACnC,MAAM,QAAQ,GAAG,eAAe,CAAC,UAAD,EAAa;AAC3C,IAAA,kBAAkB,EAAE,IADuB;AAE3C,IAAA,SAAS,EAAE;AAFgC,GAAb,CAAhC;;AAIA,MAAI,QAAQ,KAAA,IAAR,IAAA,QAAQ,KAAA,KAAA,CAAR,GAAQ,KAAA,CAAR,GAAA,QAAQ,CAAE,MAAd,EAAsB;AACpB,QAAM,SAAS,GAAG,WAAW,CAAC,KAAZ,CAAkB,QAAQ,KAAA,IAAR,IAAA,QAAQ,KAAA,KAAA,CAAR,GAAQ,KAAA,CAAR,GAAA,QAAQ,CAAE,MAA5B,CAAlB;;AACA,QAAI,SAAS,CAAC,WAAd,EAA2B;AACzB,aAAQ,SAAS,CAAC,WAAV,CAAiC,KAAjC,WAA0C,kBAA1C,QAAiE,IAAjE,CAAsE,EAAtE,CAAR;AACD,KAFD,MAEO;AACL,aAAO,IAAP;AACD;AACF,GAPD,MAOO;AACL,WAAO,IAAP;AACD;AACF;AAYD,gBAAsB,gBAAtB;AAAA;AAAA;;;+EAAO,iBAAgC,WAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACA,WADA;AAAA;AAAA;AAAA;;AAAA,kBAEG,IAAI,KAAJ,CAAU,sBAAV,CAFH;;AAAA;AAIC,YAAA,OAJD,GAIW,WAAW,CAAC,WAAD,CAAX,CAAyB,OAJpC;;AAAA,kBAKD,OAAO,OAAP,KAAmB,QALlB;AAAA;AAAA;AAAA;;AAAA,kBAMG,IAAI,KAAJ,CAAU,yCAAV,CANH;;AAAA;AAQC,YAAA,WARD,GAQe,OAAO,CAAC,YARvB;AAAA;AAAA;AAAA,mBAWoB,YAAY,CAAC,WAAD,CAXhC;;AAAA;AAWG,YAAA,QAXH;AAAA;AAAA,mBAYwB,QAAQ,CAAC,IAAT,EAZxB;;AAAA;AAYG,YAAA,YAZH;AAaG,YAAA,YAbH,GAakB,IAAI,CAAC,KAAL,CAAW,YAAX,CAblB;AAAA,6CAcH,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,MAAA,CAAA,EAAA,EAAY,YAAZ,CAAA,EAAwB;AAAE,cAAA,WAAW,EAAX;AAAF,aAAxB,CAdG;;AAAA;AAAA;AAAA;AAgBH,YAAA,OAAO,CAAC,GAAR;AAhBG,kBAiBG,IAAI,KAAJ,CAAU,+BAAV,CAjBH;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourceRoot":"","sourcesContent":["import * as queryString from 'query-string';\nimport { decodeToken } from 'jsontokens';\nimport { BLOCKSTACK_HANDLER, getGlobalObject, fetchPrivate } from '@stacks/common';\nexport function getAuthRequestFromURL() {\n    const location = getGlobalObject('location', {\n        throwIfUnavailable: true,\n        usageDesc: 'getAuthRequestFromURL',\n    });\n    if (location === null || location === void 0 ? void 0 : location.search) {\n        const queryDict = queryString.parse(location === null || location === void 0 ? void 0 : location.search);\n        if (queryDict.authRequest) {\n            return queryDict.authRequest.split(`${BLOCKSTACK_HANDLER}:`).join('');\n        }\n        else {\n            return null;\n        }\n    }\n    else {\n        return null;\n    }\n}\nexport async function fetchAppManifest(authRequest) {\n    if (!authRequest) {\n        throw new Error('Invalid auth request');\n    }\n    const payload = decodeToken(authRequest).payload;\n    if (typeof payload === 'string') {\n        throw new Error('Unexpected token payload type of string');\n    }\n    const manifestURI = payload.manifest_uri;\n    try {\n        const response = await fetchPrivate(manifestURI);\n        const responseText = await response.text();\n        const responseJSON = JSON.parse(responseText);\n        return Object.assign(Object.assign({}, responseJSON), { manifestURI });\n    }\n    catch (error) {\n        console.log(error);\n        throw new Error('Could not fetch manifest.json');\n    }\n}\n//# sourceMappingURL=provider.js.map"]},"metadata":{},"sourceType":"module"}