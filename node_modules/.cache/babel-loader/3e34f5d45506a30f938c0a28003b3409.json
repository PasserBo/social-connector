{"ast":null,"code":"import mock from'../mock';import jwt from'jsonwebtoken';const data={users:[{id:1,fullName:'John Doe',username:'johndoe',password:'admin',avatar:require('@src/assets/images/portrait/small/avatar-s-11.jpg').default,email:'admin@demo.com',role:'admin',ability:[{action:'manage',subject:'all'}],extras:{eCommerceCartItemsCount:5}},{id:2,fullName:'Jane Doe',username:'janedoe',password:'client',avatar:require('@src/assets/images/avatars/1-small.png').default,email:'client@demo.com',role:'client',ability:[{action:'read',subject:'ACL'},{action:'read',subject:'Auth'}],extras:{eCommerceCartItemsCount:5}}]};// ! These two secrets shall be in .env file and not in any other file\nconst jwtConfig={secret:'dd5f3089-40c3-403d-af14-d0c228b05cb4',refreshTokenSecret:'7c4c1c50-3230-45bf-9eae-c9b2e401c767',expireTime:'10m',refreshTokenExpireTime:'10m'};mock.onPost('/jwt/login').reply(request=>{const{email,password}=JSON.parse(request.data);let error={email:['Something went wrong']};const user=data.users.find(u=>u.email===email&&u.password===password);if(user){try{const accessToken=jwt.sign({id:user.id},jwtConfig.secret,{expiresIn:jwtConfig.expireTime});const refreshToken=jwt.sign({id:user.id},jwtConfig.refreshTokenSecret,{expiresIn:jwtConfig.refreshTokenExpireTime});const userData={...user};delete userData.password;const response={userData,accessToken,refreshToken};return[200,response];}catch(e){error=e;}}else{error={email:['Email or Password is Invalid']};}return[400,{error}];});mock.onPost('/jwt/register').reply(request=>{if(request.data.length>0){const{email,password,username}=JSON.parse(request.data);const isEmailAlreadyInUse=data.users.find(user=>user.email===email);const isUsernameAlreadyInUse=data.users.find(user=>user.username===username);const error={email:isEmailAlreadyInUse?'This email is already in use.':null,username:isUsernameAlreadyInUse?'This username is already in use.':null};if(!error.username&&!error.email){const userData={email,password,username,fullName:'',avatar:null,role:'admin',ability:[{action:'manage',subject:'all'}]};// Add user id\nconst length=data.users.length;let lastIndex=0;if(length){lastIndex=data.users[length-1].id;}userData.id=lastIndex+1;data.users.push(userData);const accessToken=jwt.sign({id:userData.id},jwtConfig.secret,{expiresIn:jwtConfig.expireTime});const user=Object.assign({},userData);delete user['password'];const response={user,accessToken};return[200,response];}else{return[200,{error}];}}});mock.onPost('/jwt/refresh-token').reply(request=>{const{refreshToken}=JSON.parse(request.data);try{const{id}=jwt.verify(refreshToken,jwtConfig.refreshTokenSecret);const userData={...data.users.find(user=>user.id===id)};const newAccessToken=jwt.sign({id:userData.id},jwtConfig.secret,{expiresIn:jwtConfig.expiresIn});const newRefreshToken=jwt.sign({id:userData.id},jwtConfig.refreshTokenSecret,{expiresIn:jwtConfig.refreshTokenExpireTime});delete userData.password;const response={userData,accessToken:newAccessToken,refreshToken:newRefreshToken};return[200,response];}catch(e){const error='Invalid refresh token';return[401,{error}];}});","map":{"version":3,"sources":["/Users/jvledesma/Downloads/react-version/full-version/src/@fake-db/jwt/index.js"],"names":["mock","jwt","data","users","id","fullName","username","password","avatar","require","default","email","role","ability","action","subject","extras","eCommerceCartItemsCount","jwtConfig","secret","refreshTokenSecret","expireTime","refreshTokenExpireTime","onPost","reply","request","JSON","parse","error","user","find","u","accessToken","sign","expiresIn","refreshToken","userData","response","e","length","isEmailAlreadyInUse","isUsernameAlreadyInUse","lastIndex","push","Object","assign","verify","newAccessToken","newRefreshToken"],"mappings":"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","sourcesContent":["import mock from '../mock'\r\nimport jwt from 'jsonwebtoken'\r\n\r\nconst data = {\r\n  users: [\r\n    {\r\n      id: 1,\r\n      fullName: 'John Doe',\r\n      username: 'johndoe',\r\n      password: 'admin',\r\n      avatar: require('@src/assets/images/portrait/small/avatar-s-11.jpg').default,\r\n      email: 'admin@demo.com',\r\n      role: 'admin',\r\n      ability: [\r\n        {\r\n          action: 'manage',\r\n          subject: 'all'\r\n        }\r\n      ],\r\n      extras: {\r\n        eCommerceCartItemsCount: 5\r\n      }\r\n    },\r\n    {\r\n      id: 2,\r\n      fullName: 'Jane Doe',\r\n      username: 'janedoe',\r\n      password: 'client',\r\n      avatar: require('@src/assets/images/avatars/1-small.png').default,\r\n      email: 'client@demo.com',\r\n      role: 'client',\r\n      ability: [\r\n        {\r\n          action: 'read',\r\n          subject: 'ACL'\r\n        },\r\n        {\r\n          action: 'read',\r\n          subject: 'Auth'\r\n        }\r\n      ],\r\n      extras: {\r\n        eCommerceCartItemsCount: 5\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\n// ! These two secrets shall be in .env file and not in any other file\r\nconst jwtConfig = {\r\n  secret: 'dd5f3089-40c3-403d-af14-d0c228b05cb4',\r\n  refreshTokenSecret: '7c4c1c50-3230-45bf-9eae-c9b2e401c767',\r\n  expireTime: '10m',\r\n  refreshTokenExpireTime: '10m'\r\n}\r\n\r\nmock.onPost('/jwt/login').reply(request => {\r\n  const { email, password } = JSON.parse(request.data)\r\n\r\n  let error = {\r\n    email: ['Something went wrong']\r\n  }\r\n\r\n  const user = data.users.find(u => u.email === email && u.password === password)\r\n\r\n  if (user) {\r\n    try {\r\n      const accessToken = jwt.sign({ id: user.id }, jwtConfig.secret, { expiresIn: jwtConfig.expireTime })\r\n      const refreshToken = jwt.sign({ id: user.id }, jwtConfig.refreshTokenSecret, {\r\n        expiresIn: jwtConfig.refreshTokenExpireTime\r\n      })\r\n\r\n      const userData = { ...user }\r\n\r\n      delete userData.password\r\n\r\n      const response = {\r\n        userData,\r\n        accessToken,\r\n        refreshToken\r\n      }\r\n\r\n      return [200, response]\r\n    } catch (e) {\r\n      error = e\r\n    }\r\n  } else {\r\n    error = {\r\n      email: ['Email or Password is Invalid']\r\n    }\r\n  }\r\n\r\n  return [400, { error }]\r\n})\r\n\r\nmock.onPost('/jwt/register').reply(request => {\r\n  if (request.data.length > 0) {\r\n    const { email, password, username } = JSON.parse(request.data)\r\n    const isEmailAlreadyInUse = data.users.find(user => user.email === email)\r\n    const isUsernameAlreadyInUse = data.users.find(user => user.username === username)\r\n    const error = {\r\n      email: isEmailAlreadyInUse ? 'This email is already in use.' : null,\r\n      username: isUsernameAlreadyInUse ? 'This username is already in use.' : null\r\n    }\r\n\r\n    if (!error.username && !error.email) {\r\n      const userData = {\r\n        email,\r\n        password,\r\n        username,\r\n        fullName: '',\r\n        avatar: null,\r\n        role: 'admin',\r\n        ability: [\r\n          {\r\n            action: 'manage',\r\n            subject: 'all'\r\n          }\r\n        ]\r\n      }\r\n\r\n      // Add user id\r\n      const length = data.users.length\r\n      let lastIndex = 0\r\n      if (length) {\r\n        lastIndex = data.users[length - 1].id\r\n      }\r\n      userData.id = lastIndex + 1\r\n\r\n      data.users.push(userData)\r\n\r\n      const accessToken = jwt.sign({ id: userData.id }, jwtConfig.secret, { expiresIn: jwtConfig.expireTime })\r\n\r\n      const user = Object.assign({}, userData)\r\n      delete user['password']\r\n      const response = { user, accessToken }\r\n\r\n      return [200, response]\r\n    } else {\r\n      return [200, { error }]\r\n    }\r\n  }\r\n})\r\n\r\nmock.onPost('/jwt/refresh-token').reply(request => {\r\n  const { refreshToken } = JSON.parse(request.data)\r\n\r\n  try {\r\n    const { id } = jwt.verify(refreshToken, jwtConfig.refreshTokenSecret)\r\n\r\n    const userData = { ...data.users.find(user => user.id === id) }\r\n\r\n    const newAccessToken = jwt.sign({ id: userData.id }, jwtConfig.secret, { expiresIn: jwtConfig.expiresIn })\r\n    const newRefreshToken = jwt.sign({ id: userData.id }, jwtConfig.refreshTokenSecret, {\r\n      expiresIn: jwtConfig.refreshTokenExpireTime\r\n    })\r\n\r\n    delete userData.password\r\n    const response = {\r\n      userData,\r\n      accessToken: newAccessToken,\r\n      refreshToken: newRefreshToken\r\n    }\r\n\r\n    return [200, response]\r\n  } catch (e) {\r\n    const error = 'Invalid refresh token'\r\n    return [401, { error }]\r\n  }\r\n})\r\n"]},"metadata":{},"sourceType":"module"}